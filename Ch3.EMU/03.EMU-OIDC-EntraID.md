---
layout: default
title: EMU EntraID와 OIDC 설정
nav_order: 3
parent: 03. Enterprise Managed User(EMU)서비스
---

## Short Code

EMU를 신청해 주실 때, 정해 주신 Short code는, GitHub.com상의 EMU서비스에서 각 엔터프라이즈 기업을 구분해 주는 ‘기업 코드’이자, 각 기업을 구별해 주는 구별자 입니다. 
- 3~8글자의 Alphanumeric 코드 입니다. 
- 기업 내부에서만 사용되는 것이므로 특별한 의미가 있는 것은 아닙니다. 
- 한번 설정되면 변경이 불가능 합니다. 
- EMU최초 설정시, ‘최초 EMU관리자’의 username은 다음과 같이 설정됩니다. 
   - `Short code_admin`
   - (예) short code가 `fabrikam` 이라면 : fabrikam_admin

<br> 

## EMU설정 순서

EMU의 설정은 아래와 같은 순서로 진행됩니다.  

1.	GitHub으로 부터 받은 관리자 초대 이메일의 버튼 클릭하여 ‘관리자 패스워드' 설정
2.	Configure OIDC SSO / SCIM for GitHub Enterprise
3.	사용자의 EMU 로그인

<br>

### [1] 관리자 초대 메일을 통해 ‘관리자 패스워드’ 설정
 
GitHub에서 EMU가 설정되면, 사전에 전달해 주셨던 관리자 이메일로 아래와 같은 초대 이메일이 전송됩니다. 

**<span style="color:red"> ** 주의 </span>** : **<span style="background-color:#fff5b1"> 반드시 브라우저의 ‘시크릿 페이지' 혹은, 별도의 브라우저 어플리케이션을 통해 패스워드를 설정 </span>** 해 주시기 바랍니다. (기존에 열려 있던 브라우저상에 GitHub.com으로의 다른 세션이 있다면, 이 세션으로 인해 문제가 발생합니다)


  ![image](./img/adminpw-incognito.png)


**<span style="color:red"> !!주의!! </span>**   설정해 주신 패스워드와, 패스워드 설정시에 나오는 <span style="background-color:#fff5b1"> Recovery 코드는 꼭 잘 저장하셔서, 분실되지 않도록 잘 관리 </span>  되어야 합니다. 

**<span style="color:red"> !!주의!! </span>** GitHub 상의 관리페이지는 **<span style="color:red"> https://github.com/enterprises/ \<your enterprise name> </span>**  입니다. 이 URL은 최초 패스워드 설정하고 로그인되었던 화면의 페이지 URL입니다. 관리 페이지 주소를 분실하지 않도록 잘 관리 되어야 합니다. 
  
 **<span style="color:red"> !!주의!! </span>**  관리페이지 URL의 **<span style="color:red"> \<your enterprise name> </span>**  : 이 부분은, 아래 2번 SSO 설정과 Auto-provisioning 설정에서 사용됩니다.
<br> 

### [2] OIDC SSO 와 SCIM 설정 
  
  사용자 추가를 위해 EntraID와의 OIDC SSO 설정 및 SCIM(Auto provisioning기능) 설정이 필요합니다. 
  ** 이 작업을 위해서는 Azure EntraID의 관리자 계정이 필요합니다. 
  
  (아래는 GitHub Help, Azure의 설정 가이드의 페이지의 설정 순서를 요약한 것입니다. 상세한 내용은 각 설명 페이지의 내용을 참조 하시기 바랍니다)
  
### <1> GitHub 관리페이지에서 OIDC 설정
  
  1) GitHub 관리 페이지로 이동합니다. 
  2) 왼편의 `Settings > Authentication security` 메뉴로 이동합니다. 
  3) `Require SAML OIDC single sign-on` 체크박스 설정 후 `save` 버튼 클릭

   ![image](./img/oidc-save.png)

  4) Entra ID로 리다이렉션 되면, 관련된 instruction을 따라 ‘GitHub Enterprise Managed User (OIDC)’ 어플리케이션 설치 
   
   **<span style="color:red"> ** 주의 </span>** : Entra ID의 <U> ‘Global admin’ 권한으로 로그인 </U>  해야 합니다. 

 5) 설치 과정에서 **‘Consent on behalf of your organization’** 클릭하고 ‘Accept’ 
   6) Enable OIDC Authentication 클릭
   
<br>

### <2> Entra ID에서 SCIM 설정 : Entra ID 설정 가이드

1) GitHub 관리자 계정의 Personal access token을 생성합니다. ([Personal access token 생성방법](https://docs.github.com/en/enterprise-cloud@latest/admin/identity-and-access-management/provisioning-user-accounts-for-enterprise-managed-users/configuring-scim-provisioning-for-enterprise-managed-users#creating-a-personal-access-token)) 
 <br> <U> ** 여기에서의 ‘GitHub 관리자 계정’은, 앞서 1번 과정에서 ‘관리자 패스워드’를 설정했던 최초 관리자 계정을 의미합니다. </U> 

2) Entra ID 설정 페이지로 이동합니다. 

3) GitHub Enterprise Managed User OIDC 어플리케이션에 대한 ‘Provisioning’을 ‘Automatic’으로 설정
    - Tenant URL 값 : `https://api.github.com/scim/v2/enterprises/<your enterprise name>`
    - Secret Token은 위에서 설정한 GitHub 관리자의 Personal Access Token 값을 입력합니다. 
    - Test Connection 실행

4) ‘Provisioning Status’를 ‘On’으로 설정합니다.
5) Scope을 설정합니다. 
6) EMU를 사용할 사용자를 추가합니다. 
    - 먼저 GitHub 관리자를 추가하고 ( <span style="color:red">현재 설정작업을 하시는 최초 관리자 분 계정을 Entra ID에서 찾아  추가합니다 </span>), Select a role메뉴에서 ‘`owner`’로 설정
    - 추가적인 관리자도 ‘owner’로 등록합니다.
    - 이후,  사용자를 추가하고, Select a role 메뉴에서 ‘`user`’로 설정

7) GitHub 관리 페이지의 ‘People’ 메뉴에서 사용자들이 Provisioning 되는 것을 확인합니다. (Entra ID의 경우 Sync까지 시간이 소요됩니다. (수동으로 바로 provisioning하는 버튼을 통해 사용자를 GitHub으로 provisioning합니다). 

<br>

### [3] 사용자의 EMU 로그인
주의 :  브라우저에서 기존에 다른 계정으로 GitHub.com에 로그인되어 있다면, 해당 계정에서 로그아웃하고, EMU 로 등록된 회사 Entra ID계정으로 로그인 하여야 합니다. 

**<span style="color:red"> ** 주의 </span>** : 사용자들이 브라우저에서 로그인 시,  username 부분에 사용자 이메일이 아닌, 아래 화면 캡쳐와 같이 ‘`_short code`'를 입력하고, ‘Sign in with your identity provider’ 버튼을 눌러, 회사의 Entra ID로 로그인 해야 합니다.  
예) short code가 ‘`fabrikam`’ 이라면 앞에 ‘`_`’를 덧붙여 ‘`_fabrikam`’을 입력

 ![image](./img/emulogin.png)